{"ast":null,"code":"var _jsxFileName = \"/home/cadu/projeto_SPR/frontend/src/components/WhatsApp/AutoSendManager.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { ClockIcon, PlayIcon, PauseIcon, StopIcon, UserGroupIcon, ExclamationTriangleIcon, CheckCircleIcon, XCircleIcon } from '@heroicons/react/24/outline';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst AutoSendManager = ({\n  contacts,\n  onSendMessage\n}) => {\n  _s();\n  const [scheduledMessages, setScheduledMessages] = useState([]);\n  const [isRunning, setIsRunning] = useState(false);\n  const [sendQueue, setSendQueue] = useState([]);\n  const [lastSendTimes, setLastSendTimes] = useState([]);\n  const [stats, setStats] = useState({\n    totalSent: 0,\n    totalFailed: 0,\n    currentRate: 0 // mensagens por minuto\n  });\n\n  // Limite de 3 disparos por minuto\n  const RATE_LIMIT = 3;\n  const RATE_WINDOW = 60000; // 1 minuto em ms\n\n  // Verificar se pode enviar mensagem (respeitando rate limit)\n  const canSendMessage = () => {\n    const now = new Date();\n    const oneMinuteAgo = new Date(now.getTime() - RATE_WINDOW);\n\n    // Filtrar envios da última minuto\n    const recentSends = lastSendTimes.filter(time => time > oneMinuteAgo);\n    return recentSends.length < RATE_LIMIT;\n  };\n\n  // Adicionar mensagem à fila de envio\n  const addToQueue = scheduledMessage => {\n    const queueItems = scheduledMessage.recipients.map(contactId => {\n      const contact = contacts.find(c => c.id === contactId);\n      if (!contact) return null;\n\n      // Personalizar mensagem baseada no tom\n      let personalizedMessage = scheduledMessage.message;\n      if (scheduledMessage.tone === 'formal') {\n        const contactName = contact.name.includes(' ') ? `Sr./Sra. ${contact.name.split(' ')[0]}` : `Sr./Sra. ${contact.name}`;\n        personalizedMessage = personalizedMessage.replace(/\\{nome\\}/g, contactName);\n      } else {\n        const firstName = contact.name.split(' ')[0];\n        personalizedMessage = personalizedMessage.replace(/\\{nome\\}/g, firstName);\n      }\n      return {\n        messageId: scheduledMessage.id,\n        contactId,\n        message: personalizedMessage\n      };\n    }).filter(Boolean);\n    setSendQueue(prev => [...prev, ...queueItems]);\n  };\n\n  // Processar fila de envio\n  useEffect(() => {\n    if (!isRunning || sendQueue.length === 0) return;\n    const interval = setInterval(async () => {\n      if (!canSendMessage()) {\n        console.log('Rate limit atingido, aguardando...');\n        return;\n      }\n      const nextItem = sendQueue[0];\n      if (!nextItem) return;\n      try {\n        // Atualizar status para \"sending\"\n        setScheduledMessages(prev => prev.map(msg => msg.id === nextItem.messageId ? {\n          ...msg,\n          status: 'sending'\n        } : msg));\n\n        // Enviar mensagem\n        const success = await onSendMessage(nextItem.contactId, nextItem.message);\n        if (success) {\n          // Registrar envio bem-sucedido\n          setLastSendTimes(prev => [...prev, new Date()]);\n          setStats(prev => ({\n            ...prev,\n            totalSent: prev.totalSent + 1\n          }));\n\n          // Atualizar contadores da mensagem\n          setScheduledMessages(prev => prev.map(msg => msg.id === nextItem.messageId ? {\n            ...msg,\n            sentCount: msg.sentCount + 1,\n            status: msg.sentCount + 1 >= msg.totalCount ? 'completed' : 'sending'\n          } : msg));\n        } else {\n          setStats(prev => ({\n            ...prev,\n            totalFailed: prev.totalFailed + 1\n          }));\n        }\n\n        // Remover item da fila\n        setSendQueue(prev => prev.slice(1));\n      } catch (error) {\n        console.error('Erro ao enviar mensagem:', error);\n        setStats(prev => ({\n          ...prev,\n          totalFailed: prev.totalFailed + 1\n        }));\n        setSendQueue(prev => prev.slice(1));\n      }\n    }, 20000); // Verificar a cada 20 segundos\n\n    return () => clearInterval(interval);\n  }, [isRunning, sendQueue, onSendMessage]);\n\n  // Verificar mensagens agendadas\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = new Date();\n      scheduledMessages.forEach(message => {\n        if (message.status === 'pending' && message.scheduledTime <= now) {\n          addToQueue(message);\n        }\n      });\n    }, 10000); // Verificar a cada 10 segundos\n\n    return () => clearInterval(interval);\n  }, [scheduledMessages]);\n\n  // Calcular taxa atual de envio\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = new Date();\n      const oneMinuteAgo = new Date(now.getTime() - RATE_WINDOW);\n      const recentSends = lastSendTimes.filter(time => time > oneMinuteAgo);\n      setStats(prev => ({\n        ...prev,\n        currentRate: recentSends.length\n      }));\n\n      // Limpar histórico antigo\n      setLastSendTimes(prev => prev.filter(time => time > oneMinuteAgo));\n    }, 5000); // Atualizar a cada 5 segundos\n\n    return () => clearInterval(interval);\n  }, [lastSendTimes]);\n\n  // Adicionar nova mensagem agendada\n  const addScheduledMessage = message => {\n    setScheduledMessages(prev => [...prev, message]);\n  };\n\n  // Cancelar mensagem agendada\n  const cancelMessage = messageId => {\n    setScheduledMessages(prev => prev.map(msg => msg.id === messageId ? {\n      ...msg,\n      status: 'cancelled'\n    } : msg));\n\n    // Remover da fila\n    setSendQueue(prev => prev.filter(item => item.messageId !== messageId));\n  };\n\n  // Pausar/retomar sistema\n  const toggleSystem = () => {\n    setIsRunning(!isRunning);\n  };\n\n  // Parar sistema e limpar fila\n  const stopSystem = () => {\n    setIsRunning(false);\n    setSendQueue([]);\n    setScheduledMessages(prev => prev.map(msg => msg.status === 'sending' || msg.status === 'pending' ? {\n      ...msg,\n      status: 'cancelled'\n    } : msg));\n  };\n  const getStatusIcon = status => {\n    switch (status) {\n      case 'pending':\n        return /*#__PURE__*/_jsxDEV(ClockIcon, {\n          className: \"h-5 w-5 text-yellow-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 16\n        }, this);\n      case 'sending':\n        return /*#__PURE__*/_jsxDEV(PlayIcon, {\n          className: \"h-5 w-5 text-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 16\n        }, this);\n      case 'completed':\n        return /*#__PURE__*/_jsxDEV(CheckCircleIcon, {\n          className: \"h-5 w-5 text-green-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 16\n        }, this);\n      case 'failed':\n        return /*#__PURE__*/_jsxDEV(XCircleIcon, {\n          className: \"h-5 w-5 text-red-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 16\n        }, this);\n      case 'cancelled':\n        return /*#__PURE__*/_jsxDEV(StopIcon, {\n          className: \"h-5 w-5 text-gray-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 16\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(ClockIcon, {\n          className: \"h-5 w-5 text-gray-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  const getStatusText = status => {\n    switch (status) {\n      case 'pending':\n        return 'Aguardando';\n      case 'sending':\n        return 'Enviando';\n      case 'completed':\n        return 'Concluído';\n      case 'failed':\n        return 'Falhou';\n      case 'cancelled':\n        return 'Cancelado';\n      default:\n        return 'Desconhecido';\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white rounded-lg shadow-sm border border-gray-200\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 border-b border-gray-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-lg font-semibold text-gray-900\",\n          children: \"Sistema de Disparo Autom\\xE1tico\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: toggleSystem,\n            className: `px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors ${isRunning ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200' : 'bg-green-100 text-green-700 hover:bg-green-200'}`,\n            children: isRunning ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(PauseIcon, {\n                className: \"h-4 w-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 260,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Pausar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(PlayIcon, {\n                className: \"h-4 w-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Iniciar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: stopSystem,\n            className: \"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(StopIcon, {\n              className: \"h-4 w-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Parar\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-4 grid grid-cols-4 gap-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-50 p-3 rounded-lg\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-blue-600 font-medium\",\n            children: \"Taxa Atual\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-semibold text-blue-900\",\n            children: [stats.currentRate, \"/\", RATE_LIMIT]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs text-blue-500\",\n            children: \"por minuto\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-green-50 p-3 rounded-lg\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-green-600 font-medium\",\n            children: \"Enviadas\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-semibold text-green-900\",\n            children: stats.totalSent\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-red-50 p-3 rounded-lg\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-red-600 font-medium\",\n            children: \"Falharam\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-semibold text-red-900\",\n            children: stats.totalFailed\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-yellow-50 p-3 rounded-lg\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-yellow-600 font-medium\",\n            children: \"Na Fila\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-semibold text-yellow-900\",\n            children: sendQueue.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }, this), stats.currentRate >= RATE_LIMIT && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(ExclamationTriangleIcon, {\n          className: \"h-5 w-5 text-yellow-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-sm text-yellow-700\",\n          children: [\"Limite de \", RATE_LIMIT, \" mensagens por minuto atingido. Aguardando...\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-md font-medium text-gray-900 mb-3\",\n        children: [\"Mensagens Agendadas (\", scheduledMessages.length, \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }, this), scheduledMessages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center py-8 text-gray-500\",\n        children: [/*#__PURE__*/_jsxDEV(UserGroupIcon, {\n          className: \"h-12 w-12 mx-auto mb-3 text-gray-300\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Nenhuma mensagem agendada\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-3\",\n        children: scheduledMessages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-start justify-between\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-2 mb-2\",\n                children: [getStatusIcon(message.status), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-sm font-medium\",\n                  children: getStatusText(message.status)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 340,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-xs text-gray-500\",\n                  children: message.scheduledTime.toLocaleString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 343,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 338,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-gray-700 mb-2 line-clamp-2\",\n                children: message.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 348,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-4 text-xs text-gray-500\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [message.sentCount, \"/\", message.totalCount, \" enviadas\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 353,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\"Tom: \", message.tone]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 356,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [message.recipients.length, \" destinat\\xE1rios\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 357,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 352,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 19\n            }, this), (message.status === 'pending' || message.status === 'sending') && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => cancelMessage(message.id),\n              className: \"ml-4 text-red-600 hover:text-red-800 transition-colors\",\n              title: \"Cancelar\",\n              children: /*#__PURE__*/_jsxDEV(XCircleIcon, {\n                className: \"h-5 w-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 369,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 17\n          }, this), message.totalCount > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-full bg-gray-200 rounded-full h-2\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-blue-600 h-2 rounded-full transition-all duration-300\",\n                style: {\n                  width: `${message.sentCount / message.totalCount * 100}%`\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 378,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 19\n          }, this)]\n        }, message.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 241,\n    columnNumber: 5\n  }, this);\n};\n_s(AutoSendManager, \"VnN/0MHMq9zK9OuNEejwV4AvTGk=\");\n_c = AutoSendManager;\nexport default AutoSendManager;\nvar _c;\n$RefreshReg$(_c, \"AutoSendManager\");","map":{"version":3,"names":["React","useState","useEffect","ClockIcon","PlayIcon","PauseIcon","StopIcon","UserGroupIcon","ExclamationTriangleIcon","CheckCircleIcon","XCircleIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","AutoSendManager","contacts","onSendMessage","_s","scheduledMessages","setScheduledMessages","isRunning","setIsRunning","sendQueue","setSendQueue","lastSendTimes","setLastSendTimes","stats","setStats","totalSent","totalFailed","currentRate","RATE_LIMIT","RATE_WINDOW","canSendMessage","now","Date","oneMinuteAgo","getTime","recentSends","filter","time","length","addToQueue","scheduledMessage","queueItems","recipients","map","contactId","contact","find","c","id","personalizedMessage","message","tone","contactName","name","includes","split","replace","firstName","messageId","Boolean","prev","interval","setInterval","console","log","nextItem","msg","status","success","sentCount","totalCount","slice","error","clearInterval","forEach","scheduledTime","addScheduledMessage","cancelMessage","item","toggleSystem","stopSystem","getStatusIcon","className","fileName","_jsxFileName","lineNumber","columnNumber","getStatusText","children","onClick","toLocaleString","title","style","width","_c","$RefreshReg$"],"sources":["/home/cadu/projeto_SPR/frontend/src/components/WhatsApp/AutoSendManager.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport {\r\n  ClockIcon,\r\n  PlayIcon,\r\n  PauseIcon,\r\n  StopIcon,\r\n  UserGroupIcon,\r\n  ExclamationTriangleIcon,\r\n  CheckCircleIcon,\r\n  XCircleIcon\r\n} from '@heroicons/react/24/outline';\r\nimport { WhatsAppContact } from '../../types';\r\n\r\ninterface ScheduledMessage {\r\n  id: string;\r\n  message: string;\r\n  recipients: string[]; // IDs dos contatos\r\n  scheduledTime: Date;\r\n  status: 'pending' | 'sending' | 'completed' | 'failed' | 'cancelled';\r\n  sentCount: number;\r\n  totalCount: number;\r\n  createdAt: Date;\r\n  tone: 'formal' | 'normal' | 'informal' | 'alegre';\r\n}\r\n\r\ninterface AutoSendManagerProps {\r\n  contacts: WhatsAppContact[];\r\n  onSendMessage: (contactId: string, message: string) => Promise<boolean>;\r\n  onStartCampaign?: (campaign: any) => void;\r\n  onPauseCampaign?: (campaignId: string) => void;\r\n  onStopCampaign?: (campaignId: string) => void;\r\n}\r\n\r\nconst AutoSendManager: React.FC<AutoSendManagerProps> = ({\r\n  contacts,\r\n  onSendMessage\r\n}) => {\r\n  const [scheduledMessages, setScheduledMessages] = useState<ScheduledMessage[]>([]);\r\n  const [isRunning, setIsRunning] = useState(false);\r\n  const [sendQueue, setSendQueue] = useState<{ messageId: string; contactId: string; message: string }[]>([]);\r\n  const [lastSendTimes, setLastSendTimes] = useState<Date[]>([]);\r\n  const [stats, setStats] = useState({\r\n    totalSent: 0,\r\n    totalFailed: 0,\r\n    currentRate: 0 // mensagens por minuto\r\n  });\r\n\r\n  // Limite de 3 disparos por minuto\r\n  const RATE_LIMIT = 3;\r\n  const RATE_WINDOW = 60000; // 1 minuto em ms\r\n\r\n  // Verificar se pode enviar mensagem (respeitando rate limit)\r\n  const canSendMessage = () => {\r\n    const now = new Date();\r\n    const oneMinuteAgo = new Date(now.getTime() - RATE_WINDOW);\r\n    \r\n    // Filtrar envios da última minuto\r\n    const recentSends = lastSendTimes.filter(time => time > oneMinuteAgo);\r\n    \r\n    return recentSends.length < RATE_LIMIT;\r\n  };\r\n\r\n  // Adicionar mensagem à fila de envio\r\n  const addToQueue = (scheduledMessage: ScheduledMessage) => {\r\n    const queueItems = scheduledMessage.recipients.map(contactId => {\r\n      const contact = contacts.find(c => c.id === contactId);\r\n      if (!contact) return null;\r\n\r\n      // Personalizar mensagem baseada no tom\r\n      let personalizedMessage = scheduledMessage.message;\r\n      \r\n      if (scheduledMessage.tone === 'formal') {\r\n        const contactName = contact.name.includes(' ') \r\n          ? `Sr./Sra. ${contact.name.split(' ')[0]}`\r\n          : `Sr./Sra. ${contact.name}`;\r\n        personalizedMessage = personalizedMessage.replace(/\\{nome\\}/g, contactName);\r\n      } else {\r\n        const firstName = contact.name.split(' ')[0];\r\n        personalizedMessage = personalizedMessage.replace(/\\{nome\\}/g, firstName);\r\n      }\r\n\r\n      return {\r\n        messageId: scheduledMessage.id,\r\n        contactId,\r\n        message: personalizedMessage\r\n      };\r\n    }).filter(Boolean) as { messageId: string; contactId: string; message: string }[];\r\n\r\n    setSendQueue(prev => [...prev, ...queueItems]);\r\n  };\r\n\r\n  // Processar fila de envio\r\n  useEffect(() => {\r\n    if (!isRunning || sendQueue.length === 0) return;\r\n\r\n    const interval = setInterval(async () => {\r\n      if (!canSendMessage()) {\r\n        console.log('Rate limit atingido, aguardando...');\r\n        return;\r\n      }\r\n\r\n      const nextItem = sendQueue[0];\r\n      if (!nextItem) return;\r\n\r\n      try {\r\n        // Atualizar status para \"sending\"\r\n        setScheduledMessages(prev => prev.map(msg => \r\n          msg.id === nextItem.messageId \r\n            ? { ...msg, status: 'sending' as const }\r\n            : msg\r\n        ));\r\n\r\n        // Enviar mensagem\r\n        const success = await onSendMessage(nextItem.contactId, nextItem.message);\r\n        \r\n        if (success) {\r\n          // Registrar envio bem-sucedido\r\n          setLastSendTimes(prev => [...prev, new Date()]);\r\n          setStats(prev => ({ ...prev, totalSent: prev.totalSent + 1 }));\r\n          \r\n          // Atualizar contadores da mensagem\r\n          setScheduledMessages(prev => prev.map(msg => \r\n            msg.id === nextItem.messageId \r\n              ? { \r\n                  ...msg, \r\n                  sentCount: msg.sentCount + 1,\r\n                  status: msg.sentCount + 1 >= msg.totalCount ? 'completed' : 'sending'\r\n                }\r\n              : msg\r\n          ));\r\n        } else {\r\n          setStats(prev => ({ ...prev, totalFailed: prev.totalFailed + 1 }));\r\n        }\r\n\r\n        // Remover item da fila\r\n        setSendQueue(prev => prev.slice(1));\r\n\r\n      } catch (error) {\r\n        console.error('Erro ao enviar mensagem:', error);\r\n        setStats(prev => ({ ...prev, totalFailed: prev.totalFailed + 1 }));\r\n        setSendQueue(prev => prev.slice(1));\r\n      }\r\n    }, 20000); // Verificar a cada 20 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isRunning, sendQueue, onSendMessage]);\r\n\r\n  // Verificar mensagens agendadas\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = new Date();\r\n      \r\n      scheduledMessages.forEach(message => {\r\n        if (message.status === 'pending' && message.scheduledTime <= now) {\r\n          addToQueue(message);\r\n        }\r\n      });\r\n    }, 10000); // Verificar a cada 10 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, [scheduledMessages]);\r\n\r\n  // Calcular taxa atual de envio\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = new Date();\r\n      const oneMinuteAgo = new Date(now.getTime() - RATE_WINDOW);\r\n      const recentSends = lastSendTimes.filter(time => time > oneMinuteAgo);\r\n      \r\n      setStats(prev => ({ ...prev, currentRate: recentSends.length }));\r\n      \r\n      // Limpar histórico antigo\r\n      setLastSendTimes(prev => prev.filter(time => time > oneMinuteAgo));\r\n    }, 5000); // Atualizar a cada 5 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, [lastSendTimes]);\r\n\r\n  // Adicionar nova mensagem agendada\r\n  const addScheduledMessage = (message: ScheduledMessage) => {\r\n    setScheduledMessages(prev => [...prev, message]);\r\n  };\r\n\r\n  // Cancelar mensagem agendada\r\n  const cancelMessage = (messageId: string) => {\r\n    setScheduledMessages(prev => prev.map(msg => \r\n      msg.id === messageId \r\n        ? { ...msg, status: 'cancelled' as const }\r\n        : msg\r\n    ));\r\n    \r\n    // Remover da fila\r\n    setSendQueue(prev => prev.filter(item => item.messageId !== messageId));\r\n  };\r\n\r\n  // Pausar/retomar sistema\r\n  const toggleSystem = () => {\r\n    setIsRunning(!isRunning);\r\n  };\r\n\r\n  // Parar sistema e limpar fila\r\n  const stopSystem = () => {\r\n    setIsRunning(false);\r\n    setSendQueue([]);\r\n    setScheduledMessages(prev => prev.map(msg => \r\n      msg.status === 'sending' || msg.status === 'pending'\r\n        ? { ...msg, status: 'cancelled' as const }\r\n        : msg\r\n    ));\r\n  };\r\n\r\n  const getStatusIcon = (status: ScheduledMessage['status']) => {\r\n    switch (status) {\r\n      case 'pending':\r\n        return <ClockIcon className=\"h-5 w-5 text-yellow-500\" />;\r\n      case 'sending':\r\n        return <PlayIcon className=\"h-5 w-5 text-blue-500\" />;\r\n      case 'completed':\r\n        return <CheckCircleIcon className=\"h-5 w-5 text-green-500\" />;\r\n      case 'failed':\r\n        return <XCircleIcon className=\"h-5 w-5 text-red-500\" />;\r\n      case 'cancelled':\r\n        return <StopIcon className=\"h-5 w-5 text-gray-500\" />;\r\n      default:\r\n        return <ClockIcon className=\"h-5 w-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: ScheduledMessage['status']) => {\r\n    switch (status) {\r\n      case 'pending': return 'Aguardando';\r\n      case 'sending': return 'Enviando';\r\n      case 'completed': return 'Concluído';\r\n      case 'failed': return 'Falhou';\r\n      case 'cancelled': return 'Cancelado';\r\n      default: return 'Desconhecido';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n      {/* Header com controles */}\r\n      <div className=\"p-4 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900\">\r\n            Sistema de Disparo Automático\r\n          </h2>\r\n          \r\n          <div className=\"flex items-center space-x-3\">\r\n            <button\r\n              onClick={toggleSystem}\r\n              className={`px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors ${\r\n                isRunning \r\n                  ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'\r\n                  : 'bg-green-100 text-green-700 hover:bg-green-200'\r\n              }`}\r\n            >\r\n              {isRunning ? (\r\n                <>\r\n                  <PauseIcon className=\"h-4 w-4\" />\r\n                  <span>Pausar</span>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <PlayIcon className=\"h-4 w-4\" />\r\n                  <span>Iniciar</span>\r\n                </>\r\n              )}\r\n            </button>\r\n            \r\n            <button\r\n              onClick={stopSystem}\r\n              className=\"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors flex items-center space-x-2\"\r\n            >\r\n              <StopIcon className=\"h-4 w-4\" />\r\n              <span>Parar</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Estatísticas */}\r\n        <div className=\"mt-4 grid grid-cols-4 gap-4\">\r\n          <div className=\"bg-blue-50 p-3 rounded-lg\">\r\n            <p className=\"text-sm text-blue-600 font-medium\">Taxa Atual</p>\r\n            <p className=\"text-lg font-semibold text-blue-900\">\r\n              {stats.currentRate}/{RATE_LIMIT}\r\n            </p>\r\n            <p className=\"text-xs text-blue-500\">por minuto</p>\r\n          </div>\r\n          \r\n          <div className=\"bg-green-50 p-3 rounded-lg\">\r\n            <p className=\"text-sm text-green-600 font-medium\">Enviadas</p>\r\n            <p className=\"text-lg font-semibold text-green-900\">{stats.totalSent}</p>\r\n          </div>\r\n          \r\n          <div className=\"bg-red-50 p-3 rounded-lg\">\r\n            <p className=\"text-sm text-red-600 font-medium\">Falharam</p>\r\n            <p className=\"text-lg font-semibold text-red-900\">{stats.totalFailed}</p>\r\n          </div>\r\n          \r\n          <div className=\"bg-yellow-50 p-3 rounded-lg\">\r\n            <p className=\"text-sm text-yellow-600 font-medium\">Na Fila</p>\r\n            <p className=\"text-lg font-semibold text-yellow-900\">{sendQueue.length}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Aviso sobre rate limit */}\r\n        {stats.currentRate >= RATE_LIMIT && (\r\n          <div className=\"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center space-x-2\">\r\n            <ExclamationTriangleIcon className=\"h-5 w-5 text-yellow-500\" />\r\n            <span className=\"text-sm text-yellow-700\">\r\n              Limite de {RATE_LIMIT} mensagens por minuto atingido. Aguardando...\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Lista de mensagens agendadas */}\r\n      <div className=\"p-4\">\r\n        <h3 className=\"text-md font-medium text-gray-900 mb-3\">\r\n          Mensagens Agendadas ({scheduledMessages.length})\r\n        </h3>\r\n\r\n        {scheduledMessages.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">\r\n            <UserGroupIcon className=\"h-12 w-12 mx-auto mb-3 text-gray-300\" />\r\n            <p>Nenhuma mensagem agendada</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {scheduledMessages.map(message => (\r\n              <div\r\n                key={message.id}\r\n                className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center space-x-2 mb-2\">\r\n                      {getStatusIcon(message.status)}\r\n                      <span className=\"text-sm font-medium\">\r\n                        {getStatusText(message.status)}\r\n                      </span>\r\n                      <span className=\"text-xs text-gray-500\">\r\n                        {message.scheduledTime.toLocaleString()}\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    <p className=\"text-sm text-gray-700 mb-2 line-clamp-2\">\r\n                      {message.message}\r\n                    </p>\r\n                    \r\n                    <div className=\"flex items-center space-x-4 text-xs text-gray-500\">\r\n                      <span>\r\n                        {message.sentCount}/{message.totalCount} enviadas\r\n                      </span>\r\n                      <span>Tom: {message.tone}</span>\r\n                      <span>\r\n                        {message.recipients.length} destinatários\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {(message.status === 'pending' || message.status === 'sending') && (\r\n                    <button\r\n                      onClick={() => cancelMessage(message.id)}\r\n                      className=\"ml-4 text-red-600 hover:text-red-800 transition-colors\"\r\n                      title=\"Cancelar\"\r\n                    >\r\n                      <XCircleIcon className=\"h-5 w-5\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Barra de progresso */}\r\n                {message.totalCount > 0 && (\r\n                  <div className=\"mt-3\">\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                      <div\r\n                        className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n                        style={{\r\n                          width: `${(message.sentCount / message.totalCount) * 100}%`\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AutoSendManager; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}